<!doctype html><html lang=zh><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Gemma JAX 推理 - ZA TAN</title><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name=renderer content="webkit"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta name=format-detection content="telephone=no,email=no,adress=no"><meta name=theme-color content="#000000"><meta http-equiv=window-target content="_top"><meta name=description content="Gemma 是一个基于 Google DeepMind 的 Gemini1 研究和技术的轻量级、最先进的开放大型语言模型家族。本教程演示了如何使用 Google DeepMind 的 gemma 库来执行 Gemma 2B Instruct 模型的基本采样/推理，该库是用 JAX2（一个高性能数值计算库）、Flax3（基于 JAX 的神经网络库）、Orbax4（一个基于 JAX 的用于训练工具如检查点的库）和 SentencePiece5（一个分词器/合词器库）编写的。尽管在这个笔记本中没有直接使用 Flax，但 Flax 被用于创建 Gemma。
"><meta name=generator content="Hugo 0.110.0 with theme pure"><title>Gemma JAX 推理 - ZA TAN</title><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/css/style.min.c58e22f1aa6179cd5cb60b9e08421a2b9a9c9fe9352d095e051b51aae209e5c0.css><link rel=stylesheet href=https://cdn.staticfile.org/highlight.js/9.15.10/styles/github.min.css async><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css async><meta property="og:title" content="Gemma JAX 推理"><meta property="og:description" content="Gemma 是一个基于 Google DeepMind 的 Gemini1 研究和技术的轻量级、最先进的开放大型语言模型家族。本教程演示了如何使用 Google DeepMind 的 gemma 库来执行 Gemma 2B Instruct 模型的基本采样/推理，该库是用 JAX2（一个高性能数值计算库）、Flax3（基于 JAX 的神经网络库）、Orbax4（一个基于 JAX 的用于训练工具如检查点的库）和 SentencePiece5（一个分词器/合词器库）编写的。尽管在这个笔记本中没有直接使用 Flax，但 Flax 被用于创建 Gemma。"><meta property="og:type" content="article"><meta property="og:url" content="https://www.ganymedenil.com/2024/04/20/Gemma-JAX-inference.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-04-20T23:10:39+00:00"><meta property="article:modified_time" content="2024-04-20T23:10:39+00:00"><meta itemprop=name content="Gemma JAX 推理"><meta itemprop=description content="Gemma 是一个基于 Google DeepMind 的 Gemini1 研究和技术的轻量级、最先进的开放大型语言模型家族。本教程演示了如何使用 Google DeepMind 的 gemma 库来执行 Gemma 2B Instruct 模型的基本采样/推理，该库是用 JAX2（一个高性能数值计算库）、Flax3（基于 JAX 的神经网络库）、Orbax4（一个基于 JAX 的用于训练工具如检查点的库）和 SentencePiece5（一个分词器/合词器库）编写的。尽管在这个笔记本中没有直接使用 Flax，但 Flax 被用于创建 Gemma。"><meta itemprop=datePublished content="2024-04-20T23:10:39+00:00"><meta itemprop=dateModified content="2024-04-20T23:10:39+00:00"><meta itemprop=wordCount content="1561"><meta itemprop=keywords content="gemma,JAX,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Gemma JAX 推理"><meta name=twitter:description content="Gemma 是一个基于 Google DeepMind 的 Gemini1 研究和技术的轻量级、最先进的开放大型语言模型家族。本教程演示了如何使用 Google DeepMind 的 gemma 库来执行 Gemma 2B Instruct 模型的基本采样/推理，该库是用 JAX2（一个高性能数值计算库）、Flax3（基于 JAX 的神经网络库）、Orbax4（一个基于 JAX 的用于训练工具如检查点的库）和 SentencePiece5（一个分词器/合词器库）编写的。尽管在这个笔记本中没有直接使用 Flax，但 Flax 被用于创建 Gemma。"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head></head><body class="main-center theme-white" itemscope itemtype=http://schema.org/WebPage><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=slimContent><div class=navbar-header><div class="profile-block text-center"><a id=avatar href=https://github.com/GanymedeNil target=_blank><img class="img-circle img-rotate" src=/avatar.png width=200 height=200></a><h2 id=name class="hidden-xs hidden-sm">Ganymede Nil</h2><h3 id=title class="hidden-xs hidden-sm hidden-md">Developer</h3><small id=location class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i>BeiJing, China</small></div><div class=search id=search-form-wrap><form class="search-form sidebar-form"><div class=input-group><input type=text class="search-form-input form-control" placeholder=搜索>
<span class=input-group-btn><button type=submit class="search-form-submit btn btn-flat" onclick=return!1><i class="icon icon-search"></i></button></span></div><div class=ins-search><div class=ins-search-mask></div><div class=ins-search-container><div class=ins-input-wrapper><input type=text class=ins-search-input placeholder=想要查找什么... x-webkit-speech>
<button type=button class="close ins-close ins-selectable" data-dismiss=modal aria-label=Close><span aria-hidden=true>×</span></button></div><div class=ins-section-wrapper><div class=ins-section-container></div></div></div></div></form></div><button class="navbar-toggle collapsed" type=button data-toggle=collapse data-target=#main-navbar aria-controls=main-navbar aria-expanded=false>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button></div><nav id=main-navbar class="collapse navbar-collapse" itemscope itemtype=http://schema.org/SiteNavigationElement role=navigation><ul class="nav navbar-nav main-nav"><li class="menu-item menu-item-home"><a href=/><i class="icon icon-home-fill"></i>
<span class=menu-title>首页</span></a></li><li class="menu-item menu-item-archives"><a href=/posts><i class="icon icon-archives-fill"></i>
<span class=menu-title>归档</span></a></li><li class="menu-item menu-item-categories"><a href=/categories><i class="icon icon-folder"></i>
<span class=menu-title>分类</span></a></li><li class="menu-item menu-item-tags"><a href=/tags><i class="icon icon-tags"></i>
<span class=menu-title>标签</span></a></li><li class="menu-item menu-item-links"><a href=/links><i class="icon icon-friendship"></i>
<span class=menu-title>友链</span></a></li><li class="menu-item menu-item-about"><a href=/about><i class="icon icon-cup-fill"></i>
<span class=menu-title>关于</span></a></li></ul></nav></div></header><aside class=sidebar itemscope itemtype=http://schema.org/WPSideBar><div class=slimContent><div class=widget><h3 class=widget-title>公告</h3><div class=widget-body><div id=board><div class=content><p>欢迎交流与分享经验!~</p></div></div></div></div><div class=widget><h3 class=widget-title>分类</h3><div class=widget-body><ul class=category-list><li class=category-list-item><a href=/categories/AI/ class=category-list-link>AI</a><span class=category-list-count>6</span></li><li class=category-list-item><a href=/categories/Go/ class=category-list-link>Go</a><span class=category-list-count>2</span></li><li class=category-list-item><a href=/categories/Laravel/ class=category-list-link>Laravel</a><span class=category-list-count>1</span></li><li class=category-list-item><a href=/categories/PHP/ class=category-list-link>PHP</a><span class=category-list-count>1</span></li><li class=category-list-item><a href=/categories/go%E5%9F%BA%E7%A1%80%E5%BA%93/ class=category-list-link>go基础库</a><span class=category-list-count>52</span></li><li class=category-list-item><a href=/categories/php7/ class=category-list-link>php7</a><span class=category-list-count>5</span></li><li class=category-list-item><a href=/categories/%E5%86%99%E7%BB%99%E5%A4%A7%E5%BF%99%E4%BA%BA%E7%9C%8B%E7%9A%84NGINX/ class=category-list-link>写给大忙人看的NGINX</a><span class=category-list-count>1</span></li><li class=category-list-item><a href=/categories/%E5%86%99%E7%BB%99%E5%A4%A7%E5%BF%99%E4%BA%BA%E7%9C%8B%E7%9A%84%E6%8A%80%E6%9C%AF%E4%B9%A6%E7%B3%BB%E7%B1%BB/ class=category-list-link>写给大忙人看的技术书系类</a><span class=category-list-count>1</span></li><li class=category-list-item><a href=/categories/%E5%89%8D%E7%AB%AF/ class=category-list-link>前端</a><span class=category-list-count>1</span></li><li class=category-list-item><a href=/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/ class=category-list-link>区块链</a><span class=category-list-count>3</span></li><li class=category-list-item><a href=/categories/%E5%BC%80%E5%8F%91/ class=category-list-link>开发</a><span class=category-list-count>17</span></li><li class=category-list-item><a href=/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/ class=category-list-link>微服务</a><span class=category-list-count>1</span></li><li class=category-list-item><a href=/categories/%E6%9E%B6%E6%9E%84/ class=category-list-link>架构</a><span class=category-list-count>1</span></li></ul></div></div><div class=widget><h3 class=widget-title>标签</h3><div class=widget-body><ul class=tag-list><li class=tag-list-item><a href=/tags/Hardhat/ class=tag-list-link>Hardhat</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/JAX/ class=tag-list-link>JAX</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/LLM/ class=tag-list-link>LLM</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/NFT/ class=tag-list-link>NFT</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/Php-Storm/ class=tag-list-link>Php-Storm</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/Predis/ class=tag-list-link>Predis</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/SOL/ class=tag-list-link>SOL</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/Solana/ class=tag-list-link>Solana</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/Solidity/ class=tag-list-link>Solidity</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/ddd/ class=tag-list-link>ddd</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/docker/ class=tag-list-link>docker</a><span class=tag-list-count>4</span></li><li class=tag-list-item><a href=/tags/gemma/ class=tag-list-link>gemma</a><span class=tag-list-count>5</span></li><li class=tag-list-item><a href=/tags/go/ class=tag-list-link>go</a><span class=tag-list-count>57</span></li><li class=tag-list-item><a href=/tags/hexo/ class=tag-list-link>hexo</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/kerasNLP/ class=tag-list-link>kerasNLP</a><span class=tag-list-count>3</span></li><li class=tag-list-item><a href=/tags/laravel/ class=tag-list-link>laravel</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/linux/ class=tag-list-link>linux</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/nginx/ class=tag-list-link>nginx</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/nuxt/ class=tag-list-link>nuxt</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/php/ class=tag-list-link>php</a><span class=tag-list-count>5</span></li><li class=tag-list-item><a href=/tags/redis/ class=tag-list-link>redis</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/rust/ class=tag-list-link>rust</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/swoole/ class=tag-list-link>swoole</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/web3/ class=tag-list-link>web3</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/xdebug/ class=tag-list-link>xdebug</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/%E4%BB%A5%E5%A4%AA%E5%9D%8A/ class=tag-list-link>以太坊</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/%E6%80%BB%E7%BB%93/ class=tag-list-link>总结</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/ class=tag-list-link>智能合约</a><span class=tag-list-count>1</span></li></ul></div></div><div class=widget><h3 class=widget-title>最新文章</h3><div class=widget-body><ul class="recent-post-list list-unstyled no-thumbnail"><li><div class=item-inner><p class=item-title><a href=/2025/01/23/solana-tutorial-1.html class=title>Solana 链开发实战（一）</a></p><p class=item-date><time datetime="2025-01-23 18:08:23 +0000 UTC" itemprop=datePublished>2025-01-23</time></p></div></li><li><div class=item-inner><p class=item-title><a href=/2024/04/20/Gemma-JAX-inference.html class=title>Gemma JAX 推理</a></p><p class=item-date><time datetime="2024-04-20 23:10:39 +0000 UTC" itemprop=datePublished>2024-04-20</time></p></div></li><li><div class=item-inner><p class=item-title><a href=/2024/03/30/Keras-Gemma-distributed-finetuning-and-inference.html class=title>在使用 Keras 进行 Gemma 模型的分布式微调和推理</a></p><p class=item-date><time datetime="2024-03-30 22:32:29 +0000 UTC" itemprop=datePublished>2024-03-30</time></p></div></li><li><div class=item-inner><p class=item-title><a href=/2024/03/30/Fine-tune-Gemma-model-in-Keras-using-LoRA.html class=title>在 Keras 中使用 LoRA 微调 Gemma 模型</a></p><p class=item-date><time datetime="2024-03-30 21:42:12 +0000 UTC" itemprop=datePublished>2024-03-30</time></p></div></li><li><div class=item-inner><p class=item-title><a href=/2024/03/30/Get-started-with-Gemma-using-KerasNLP.html class=title>使用 KerasNLP 快速开始 Gemma</a></p><p class=item-date><time datetime="2024-03-30 19:20:02 +0000 UTC" itemprop=datePublished>2024-03-30</time></p></div></li></ul></div></div></div></aside><aside class="sidebar sidebar-toc collapse" id=collapseToc itemscope itemtype=http://schema.org/WPSideBar><div class=slimContent><h4 class=toc-title>文章目录</h4><nav id=toc class="js-toc toc"></nav></div></aside><main class=main role=main><div class=content><article id=- class="article article-type-" itemscope itemtype=http://schema.org/BlogPosting><div class=article-header><h1 itemprop=name><a class=article-title href=/2024/04/20/Gemma-JAX-inference.html>Gemma JAX 推理</a></h1><div class=article-meta><span class=article-date><i class="icon icon-calendar-check"></i>&nbsp;
<a href=/2024/04/20/Gemma-JAX-inference.html class=article-date><time datetime="2024-04-20 23:10:39 +0000 UTC" itemprop=datePublished>2024-04-20</time></a></span>
<span class=article-category><i class="icon icon-folder"></i>&nbsp;
<a class=article-category-link href=/categories/%E5%BC%80%E5%8F%91/>开发</a>
<a class=article-category-link href=/categories/AI/>AI</a></span>
<span class=article-tag><i class="icon icon-tags"></i>&nbsp;
<a class=article-tag-link href=/tags/gemma/>gemma</a>
<a class=article-tag-link href=/tags/JAX/>JAX</a></span>
<span class=post-comment><i class="icon icon-comment"></i>&nbsp;<a href=/2024/04/20/Gemma-JAX-inference.html#comments class=article-comment-link>评论</a></span>
<span class="post-wordcount hidden-xs" itemprop=wordCount>字数统计: 1561字</span>
<span class="post-readcount hidden-xs" itemprop=timeRequired>阅读时长: 4分</span></div></div><div class="article-entry marked-body js-toc-content" itemprop=articleBody><p>Gemma 是一个基于 Google DeepMind 的 Gemini<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> 研究和技术的轻量级、最先进的开放大型语言模型家族。本教程演示了如何使用 Google DeepMind 的 gemma 库来执行 Gemma 2B Instruct 模型的基本采样/推理，该库是用 JAX<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>（一个高性能数值计算库）、Flax<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>（基于 JAX 的神经网络库）、Orbax<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>（一个基于 JAX 的用于训练工具如检查点的库）和 SentencePiece<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup>（一个分词器/合词器库）编写的。尽管在这个笔记本中没有直接使用 Flax，但 Flax 被用于创建 Gemma。</p><h2 id=设置>设置</h2><h3 id=1-设置-kaggle-上的-gemma-访问权限>1. 设置 Kaggle 上的 Gemma 访问权限</h3><p>要完成本教程，您首先需要按照 Gemma 设置<sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup>说明操作，这些说明将向您展示如何执行以下操作：</p><ul><li>在 kaggle.com<sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup> 上获取对 Gemma 的访问权限。</li><li>选择一个具有足够资源的 Colab 运行环境来运行 Gemma 模型。</li><li>生成并配置 Kaggle 用户名和 API 密钥。</li></ul><p>完成 Gemma 设置后，继续进行下一部分，您将为您的 Colab 环境设置环境变量。</p><h3 id=2-设置环境变量>2. 设置环境变量</h3><p>为 <code>KAGGLE_USERNAME</code> 和 <code>KAGGLE_KEY</code> 设置环境变量。在出现“授权访问？”的提示时，同意提供密钥访问。</p><pre><code class=language-python>from kaggle_secrets import UserSecretsClient
user_secrets = UserSecretsClient()
secret_value_0 = user_secrets.get_secret(&quot;KAGGLE_KEY &quot;)
secret_value_1 = user_secrets.get_secret(&quot;KAGGLE_USERNAME&quot;)
</code></pre><h3 id=3-安装-gemma-库>3. 安装 gemma 库</h3><p>本笔记本着重于使用免费的 Colab GPU。要启用硬件加速，请点击编辑 > 笔记本设置 > 选择 T4 GPU > 保存。</p><p>接下来，您需要从 github.com/google-deepmind/gemma 安装 Google DeepMind 的 gemma 库。如果您遇到关于“pip 的依赖解析器”的错误，通常可以忽略它。</p><p>注意：通过安装 gemma，您还将安装 flax、core jax、optax（基于 JAX 的梯度处理和优化库）、orbax 和 sentencepiece。</p><pre><code class=language-bash>!pip install -q git+https://github.com/google-deepmind/gemma.git
</code></pre><h2 id=加载并准备-gemma-模型>加载并准备 Gemma 模型</h2><p>使用 <code>kagglehub.model_download</code> 加载 Gemma 模型，该函数需要三个参数：</p><ul><li>handle：来自 Kaggle 的模型句柄</li><li>path：（可选字符串）本地路径</li><li>force_download：（可选布尔值）强制重新下载模型</li></ul><blockquote><p>注意：gemma-2b-it 模型的大小约为 3.7Gb。</p></blockquote><pre><code class=language-bash>GEMMA_VARIANT = '2b-it' # @param ['2b', '2b-it'] {type:&quot;string&quot;}
</code></pre><pre><code class=language-python>import kagglehub

GEMMA_PATH = kagglehub.model_download(f'google/gemma/flax/{GEMMA_VARIANT}')
</code></pre><pre><code class=language-python>print('GEMMA_PATH:', GEMMA_PATH)
</code></pre><pre><code class=language-bash>GEMMA_PATH: /kaggle/input/gemma/flax/2b-it/2
</code></pre><blockquote><p>注意：上面输出的路径是模型权重和令牌器在本地保存的地方，之后我们还会需要。</p></blockquote><p>检查模型权重和分词器的位置，然后设置路径变量。分词器目录将位于您下载模型的主目录中，而模型权重将位于一个子目录中。例如：</p><ul><li>分词器的 <code>tokenizer.model</code> 文件将位于 <code>/LOCAL/PATH/TO/gemma/flax/2b-it/2</code>。</li><li>模型的检查点将位于 <code>/LOCAL/PATH/TO/gemma/flax/2b-it/2/2b-it</code>。</li></ul><p>在进行下一步之前，请确保正确设置这些路径，以便您的代码能够正确访问和加载模型及其组件。</p><pre><code class=language-python>CKPT_PATH = os.path.join(GEMMA_PATH, GEMMA_VARIANT)
TOKENIZER_PATH = os.path.join(GEMMA_PATH, 'tokenizer.model')
print('CKPT_PATH:', CKPT_PATH)
print('TOKENIZER_PATH:', TOKENIZER_PATH)
</code></pre><pre><code class=language-bash>CKPT_PATH: /kaggle/input/gemma/flax/2b-it/2/2b-it
TOKENIZER_PATH: /kaggle/input/gemma/flax/2b-it/2/tokenizer.model
</code></pre><h2 id=执行抽样推理>执行抽样/推理</h2><p>加载和格式化 Gemma 模型检查点，使用 <code>gemma.params.load_and_format_params</code> 方法：</p><pre><code class=language-python>from gemma import params as params_lib

params = params_lib.load_and_format_params(CKPT_PATH)
</code></pre><p>加载使用 <code>sentencepiece.SentencePieceProcessor</code> 构建的 Gemma 分词器：</p><pre><code class=language-python>import sentencepiece as spm

vocab = spm.SentencePieceProcessor()
vocab.Load(TOKENIZER_PATH)
</code></pre><pre><code class=language-bash>True
</code></pre><p>要从 Gemma 模型检查点自动加载正确的配置，请使用 <code>gemma.transformer.TransformerConfig</code>。cache_size 参数是 Gemma Transformer 缓存中的时间步数。之后，使用 <code>gemma.transformer.Transformer</code>（继承自 <code>flax.linen.Module</code>）实例化 Gemma 模型为 transformer。</p><blockquote><p>注意：由于当前 Gemma 版本中存在未使用的令牌，词汇量比输入嵌入的数量小。</p></blockquote><pre><code class=language-python>from gemma import transformer as transformer_lib

transformer_config = transformer_lib.TransformerConfig.from_params(
    params=params,
    cache_size=1024
)

transformer = transformer_lib.Transformer(transformer_config)
</code></pre><p>创建一个采样器，使用 <code>gemma.sampler.Sampler</code> 在 Gemma 模型的检查点/权重和分词器之上：</p><pre><code class=language-python>from gemma import sampler as sampler_lib

sampler = sampler_lib.Sampler(
    transformer=transformer,
    vocab=vocab,
    params=params['transformer'],
)
</code></pre><p>在 input_batch 中编写一个提示，并执行推理。可以调整 total_generation_steps（生成响应时执行的步数 —— 本例中使用100以保存主机内存）。</p><blockquote><p>注意：如果内存不足，请点击 Runtime > Disconnect and delete runtime，然后选择 Runtime > Run all。</p></blockquote><pre><code class=language-python>prompt = [
    &quot;\n# What is the meaning of life?&quot;,
]

reply = sampler(input_strings=prompt,
                total_generation_steps=100,
                )

for input_string, out_string in zip(prompt, reply.text):
    print(f&quot;Prompt:\n{input_string}\nOutput:\n{out_string}&quot;)
</code></pre><pre><code class=language-bash>Prompt:

# What is the meaning of life?
Output:


The question of what the meaning of life is one that has occupied the minds of philosophers, theologians, and individuals for centuries. There is no single, universally accepted answer, but there are many different perspectives on this complex and multifaceted question.

**Some common perspectives on the meaning of life include:**

* **Biological perspective:** From a biological standpoint, the meaning of life is to survive and reproduce.
* **Existential perspective:** Existentialists believe that life is not inherently meaningful and that
</code></pre><p>（可选）如果已完成笔记本并想尝试其他提示，运行此单元以释放内存。之后，可以在第三步再次实例化采样器，并在第四步自定义并运行提示。</p><pre><code class=language-python>del sampler
</code></pre><h2 id=来源>来源</h2><p>本文翻译自 Gemma JAX inference <a href=https://www.kaggle.com/code/windmaple/gemma-jax-inference>https://www.kaggle.com/code/windmaple/gemma-jax-inference</a></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Google DeepMind 的 Gemini <a href=https://github.com/google-deepmind/gemma>https://github.com/google-deepmind/gemma</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>JAX <a href=https://jax.readthedocs.io/>https://jax.readthedocs.io/</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>Flax <a href=https://flax.readthedocs.io/>https://flax.readthedocs.io/</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>Orbax <a href=https://orbax.readthedocs.io/>https://orbax.readthedocs.io/</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p>SentencePiece <a href=https://github.com/google/sentencepiece>https://github.com/google/sentencepiece</a>&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p>Gemma 设置 <a href=https://ai.google.dev/gemma/docs/setup>https://ai.google.dev/gemma/docs/setup</a>&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7><p>kaggle gemma 模型 <a href=https://www.kaggle.com/models/google/gemma/>https://www.kaggle.com/models/google/gemma/</a>&#160;<a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=article-footer><blockquote class=mt-2x><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>本文链接:</strong>
<a href=https://www.ganymedenil.com/2024/04/20/Gemma-JAX-inference.html title="Gemma JAX 推理" target=_blank rel=external>https://www.ganymedenil.com/2024/04/20/Gemma-JAX-inference.html</a></li><li class=post-copyright-license><strong>版权声明：</strong><a href=http://creativecommons.org/licenses/by/4.0/deed.zh target=_blank rel=external>本博客所有文章除特别声明外，均采用 CC BY 4.0 CN协议 许可协议。转载请注明出处</a></li></ul></blockquote><div class="panel panel-default panel-badger"><div class=panel-body><figure class=media><div class=media-left><a href=https://github.com/GanymedeNil target=_blank class="img-burn thumb-sm visible-lg"><img src=/avatar.png class="img-rounded w-full" alt></a></div><div class=media-body><h3 class=media-heading><a href=https://github.com/GanymedeNil target=_blank><span class=text-dark>Ganymede Nil</span><small class=ml-1x>Developer</small></a></h3><div>喜欢新事物，关注后端动态，对新的技术有追求； 喜欢 coding。</div></div></figure></div></div></div></article><section id=comments><div id=vcomments></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom><div class=bar-inner><ul class="pager pull-left"><li class=prev><a href=/2024/03/30/Keras-Gemma-distributed-finetuning-and-inference.html title="在使用 Keras 进行 Gemma 模型的分布式微调和推理"><i class="icon icon-angle-left" aria-hidden=true></i><span>&nbsp;&nbsp;下一篇</span></a></li><li class=next><a href=/2025/01/23/solana-tutorial-1.html title="Solana 链开发实战（一）"><span>上一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden=true></i></a></li><li class=toggle-toc><a class="toggle-btn collapsed" data-toggle=collapse href=#collapseToc aria-expanded=false title=文章目录 role=button><span>[&nbsp;</span><span>文章目录</span>
<i class="text-collapsed icon icon-anchor"></i>
<i class="text-in icon icon-close"></i>
<span>]</span></a></li></ul><button type=button class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle=modal data-target=#donateModal><span>赏</span></button><div class=bar-right><div class=share-component data-sites=weibo,qq,wechat,facebook,twitter data-mobile-sites=weibo,qq,qzone></div></div></div></nav><div class="modal modal-center modal-small modal-xs-full fade" id=donateModal tabindex=-1 role=dialog><div class=modal-dialog role=document><div class="modal-content donate"><button type=button class=close data-dismiss=modal aria-label=Close><span aria-hidden=true>&#215;</span></button><div class=modal-body><div class=donate-box><div class=donate-head><p>感谢您的支持,我会继续努力的!</p></div><div class=tab-content><div role=tabpanel class="tab-pane fade active in" id=alipay><div class=donate-payimg><img src=/donate/alipay.jpg alt=扫码支持 title=扫一扫></div><p class="text-muted mv">扫码打赏, 多少你说了算~</p><p class=text-grey>打开支付宝扫一扫，即可进行扫码打赏哦~</p></div><div role=tabpanel class="tab-pane fade" id=wechatpay><div class=donate-payimg><img src=/donate/weipay.jpg alt=扫码支持 title=扫一扫></div><p class="text-muted mv">扫码打赏, 多少你说了算~</p><p class=text-grey>打开微信扫一扫，即可进行扫码打赏哦</p></div></div><div class=donate-footer><ul class="nav nav-tabs nav-justified" role=tablist><li role=presentation class=active><a href=#alipay id=alipay-tab role=tab data-toggle=tab aria-controls=alipay aria-expanded=true><i class="icon icon-alipay"></i> 支付宝</a></li><li role=presentation><a href=#wechatpay role=tab id=wechatpay-tab data-toggle=tab aria-controls=wechatpay aria-expanded=false><i class="icon icon-wepay"></i>
微信支付</a></li></ul></div></div></div></div></div></div></main><footer class=footer itemscope itemtype=http://schema.org/WPFooter><ul class=social-links><li><a href=https://github.com/GanymedeNil target=_blank title=github data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li><li><a href=/index.xml target=_blank title=rss data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li><li><a href=http://weibo.com/jinhongyang target=_blank title=weibo data-toggle=tooltip data-placement=top><i class="icon icon-weibo"></i></a></li></ul><div class=copyright>&copy;2017 -
2025<div class=publishby>Theme by <a href=https://github.com/cofess target=_blank>cofess </a>base on<a href=https://github.com/cofess/hexo-theme-pure target=_blank> pure</a>.</div><div>powered by <a href=https://gohugo.io/ target=_blank>hugo</a></div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<script type=text/x-mathjax-config>
    MathJax.Hub.Config({
            showMathMenu: false, //disables context menu
            tex2jax: {
            inlineMath: [ ['$','$'], ['\\(','\\)'] ]
           }
    });
</script><script src=https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js></script>
<script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/highlight.min.js></script>
<script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/languages/go.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/languages/php.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/languages/bash.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/languages/cmake.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/languages/dockerfile.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/languages/json.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/languages/lua.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/languages/makefile.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/languages/nginx.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/languages/rust.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/languages/shell.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/languages/yaml.min.js defer></script><script>hljs.configure({tabReplace:"    ",classPrefix:""}),hljs.initHighlightingOnLoad()</script>
<script src=/js/application.min.7ef841188add421ff966768c2e5f1a1551076353a65f0d39fbaf504b456936f8.js></script>
<script src=/js/plugin.min.738a460bf4317fac61717f1bca393e53d00973db9754d9f0a81c7312d5874840.js></script>
<script>(function(e){var t={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"(未命名)"},ROOT_URL:"https://www.ganymedenil.com",CONTENT_URL:"https://www.ganymedenil.com/searchindex.json "};e.INSIGHT_CONFIG=t})(window)</script><script type=text/javascript src=/js/insight.min.716b0c6a00b68ccc31a2b65345f3412f4246ffa94a90f8e25d525528b4504f9937880692bbe619023233caba5d0a17ebe23d7cfb57cd3a88f23ea337ad5e4d00.js defer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js></script>
<script>tocbot.init({tocSelector:".js-toc",contentSelector:".js-toc-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0})</script><script src=https://cdn1.lncld.net/static/js/3.0.4/av-min.js></script>
<script src=https://cdn.jsdelivr.net/npm/valine></script>
<script type=text/javascript>var GUEST=["nick","mail","link"],meta="nick,mail",meta=meta.split(",").filter(function(e){return GUEST.indexOf(e)>-1});new Valine({el:"#vcomments",verify:null,notify:null,appId:"lI57bh1xqblhjL3OUrOcnX2R-gzGzoHsz",appKey:"2aCHvIxz6nKXqP0sBq42gBhC",placeholder:"enjoy~",avatar:"mm",meta,pageSize:"10"||10,visitor:!1})</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-140810980-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-140810980-1")</script></body></html>