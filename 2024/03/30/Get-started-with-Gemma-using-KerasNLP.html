<!doctype html><html lang=zh><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>使用 KerasNLP 快速开始 Gemma - ZA TAN</title><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name=renderer content="webkit"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta name=format-detection content="telephone=no,email=no,adress=no"><meta name=theme-color content="#000000"><meta http-equiv=window-target content="_top"><meta name=description content="本教程将向您展示如何使用 KerasNLP1 开始使用 Gemma。Gemma 是一个轻量级的、采用最新技术的开放模型家族，这些技术源于创建 Gemini 模型的同一研究和技术。KerasNLP 是一个自然语言处理（NLP）模型的集合，这些模型使用 Keras2 实现，并能在 JAX、PyTorch 和 TensorFlow 上运行。
在本教程中，您将使用 Gemma 生成对几个提示的文本响应。如果您对 Keras 不熟悉，可能会想在开始前阅读《 Keras 入门3》，但这不是必须的。通过本教程的学习，您将更加了解 Keras。
"><meta name=generator content="Hugo 0.110.0 with theme pure"><title>使用 KerasNLP 快速开始 Gemma - ZA TAN</title><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/css/style.min.c58e22f1aa6179cd5cb60b9e08421a2b9a9c9fe9352d095e051b51aae209e5c0.css><link rel=stylesheet href=https://cdn.staticfile.org/highlight.js/9.15.10/styles/github.min.css async><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css async><meta property="og:title" content="使用 KerasNLP 快速开始 Gemma"><meta property="og:description" content="本教程将向您展示如何使用 KerasNLP1  开始使用 Gemma。Gemma 是一个轻量级的、采用最新技术的开放模型家族，这些技术源于创建 Gemini 模型的同一研究和技术。KerasNLP 是一个自然语言处理（NLP）模型的集合，这些模型使用 Keras2 实现，并能在 JAX、PyTorch 和 TensorFlow 上运行。
在本教程中，您将使用 Gemma 生成对几个提示的文本响应。如果您对 Keras 不熟悉，可能会想在开始前阅读《 Keras 入门3》，但这不是必须的。通过本教程的学习，您将更加了解 Keras。"><meta property="og:type" content="article"><meta property="og:url" content="https://www.ganymedenil.com/2024/03/30/Get-started-with-Gemma-using-KerasNLP.html"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-30T19:20:02+00:00"><meta property="article:modified_time" content="2024-03-30T19:20:02+00:00"><meta itemprop=name content="使用 KerasNLP 快速开始 Gemma"><meta itemprop=description content="本教程将向您展示如何使用 KerasNLP1  开始使用 Gemma。Gemma 是一个轻量级的、采用最新技术的开放模型家族，这些技术源于创建 Gemini 模型的同一研究和技术。KerasNLP 是一个自然语言处理（NLP）模型的集合，这些模型使用 Keras2 实现，并能在 JAX、PyTorch 和 TensorFlow 上运行。
在本教程中，您将使用 Gemma 生成对几个提示的文本响应。如果您对 Keras 不熟悉，可能会想在开始前阅读《 Keras 入门3》，但这不是必须的。通过本教程的学习，您将更加了解 Keras。"><meta itemprop=datePublished content="2024-03-30T19:20:02+00:00"><meta itemprop=dateModified content="2024-03-30T19:20:02+00:00"><meta itemprop=wordCount content="1800"><meta itemprop=keywords content="gemma,kerasNLP,"><meta name=twitter:card content="summary"><meta name=twitter:title content="使用 KerasNLP 快速开始 Gemma"><meta name=twitter:description content="本教程将向您展示如何使用 KerasNLP1  开始使用 Gemma。Gemma 是一个轻量级的、采用最新技术的开放模型家族，这些技术源于创建 Gemini 模型的同一研究和技术。KerasNLP 是一个自然语言处理（NLP）模型的集合，这些模型使用 Keras2 实现，并能在 JAX、PyTorch 和 TensorFlow 上运行。
在本教程中，您将使用 Gemma 生成对几个提示的文本响应。如果您对 Keras 不熟悉，可能会想在开始前阅读《 Keras 入门3》，但这不是必须的。通过本教程的学习，您将更加了解 Keras。"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head></head><body class="main-center theme-white" itemscope itemtype=http://schema.org/WebPage><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=slimContent><div class=navbar-header><div class="profile-block text-center"><a id=avatar href=https://github.com/GanymedeNil target=_blank><img class="img-circle img-rotate" src=/avatar.png width=200 height=200></a><h2 id=name class="hidden-xs hidden-sm">Ganymede Nil</h2><h3 id=title class="hidden-xs hidden-sm hidden-md">Developer</h3><small id=location class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i>BeiJing, China</small></div><div class=search id=search-form-wrap><form class="search-form sidebar-form"><div class=input-group><input type=text class="search-form-input form-control" placeholder=搜索>
<span class=input-group-btn><button type=submit class="search-form-submit btn btn-flat" onclick=return!1><i class="icon icon-search"></i></button></span></div><div class=ins-search><div class=ins-search-mask></div><div class=ins-search-container><div class=ins-input-wrapper><input type=text class=ins-search-input placeholder=想要查找什么... x-webkit-speech>
<button type=button class="close ins-close ins-selectable" data-dismiss=modal aria-label=Close><span aria-hidden=true>×</span></button></div><div class=ins-section-wrapper><div class=ins-section-container></div></div></div></div></form></div><button class="navbar-toggle collapsed" type=button data-toggle=collapse data-target=#main-navbar aria-controls=main-navbar aria-expanded=false>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button></div><nav id=main-navbar class="collapse navbar-collapse" itemscope itemtype=http://schema.org/SiteNavigationElement role=navigation><ul class="nav navbar-nav main-nav"><li class="menu-item menu-item-home"><a href=/><i class="icon icon-home-fill"></i>
<span class=menu-title>首页</span></a></li><li class="menu-item menu-item-archives"><a href=/posts><i class="icon icon-archives-fill"></i>
<span class=menu-title>归档</span></a></li><li class="menu-item menu-item-categories"><a href=/categories><i class="icon icon-folder"></i>
<span class=menu-title>分类</span></a></li><li class="menu-item menu-item-tags"><a href=/tags><i class="icon icon-tags"></i>
<span class=menu-title>标签</span></a></li><li class="menu-item menu-item-links"><a href=/links><i class="icon icon-friendship"></i>
<span class=menu-title>友链</span></a></li><li class="menu-item menu-item-about"><a href=/about><i class="icon icon-cup-fill"></i>
<span class=menu-title>关于</span></a></li></ul></nav></div></header><aside class=sidebar itemscope itemtype=http://schema.org/WPSideBar><div class=slimContent><div class=widget><h3 class=widget-title>公告</h3><div class=widget-body><div id=board><div class=content><p>欢迎交流与分享经验!~</p></div></div></div></div><div class=widget><h3 class=widget-title>分类</h3><div class=widget-body><ul class=category-list><li class=category-list-item><a href=/categories/AI/ class=category-list-link>AI</a><span class=category-list-count>6</span></li><li class=category-list-item><a href=/categories/Go/ class=category-list-link>Go</a><span class=category-list-count>2</span></li><li class=category-list-item><a href=/categories/Laravel/ class=category-list-link>Laravel</a><span class=category-list-count>1</span></li><li class=category-list-item><a href=/categories/PHP/ class=category-list-link>PHP</a><span class=category-list-count>1</span></li><li class=category-list-item><a href=/categories/go%E5%9F%BA%E7%A1%80%E5%BA%93/ class=category-list-link>go基础库</a><span class=category-list-count>52</span></li><li class=category-list-item><a href=/categories/php7/ class=category-list-link>php7</a><span class=category-list-count>5</span></li><li class=category-list-item><a href=/categories/%E5%86%99%E7%BB%99%E5%A4%A7%E5%BF%99%E4%BA%BA%E7%9C%8B%E7%9A%84NGINX/ class=category-list-link>写给大忙人看的NGINX</a><span class=category-list-count>1</span></li><li class=category-list-item><a href=/categories/%E5%86%99%E7%BB%99%E5%A4%A7%E5%BF%99%E4%BA%BA%E7%9C%8B%E7%9A%84%E6%8A%80%E6%9C%AF%E4%B9%A6%E7%B3%BB%E7%B1%BB/ class=category-list-link>写给大忙人看的技术书系类</a><span class=category-list-count>1</span></li><li class=category-list-item><a href=/categories/%E5%89%8D%E7%AB%AF/ class=category-list-link>前端</a><span class=category-list-count>1</span></li><li class=category-list-item><a href=/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/ class=category-list-link>区块链</a><span class=category-list-count>3</span></li><li class=category-list-item><a href=/categories/%E5%BC%80%E5%8F%91/ class=category-list-link>开发</a><span class=category-list-count>17</span></li><li class=category-list-item><a href=/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/ class=category-list-link>微服务</a><span class=category-list-count>1</span></li><li class=category-list-item><a href=/categories/%E6%9E%B6%E6%9E%84/ class=category-list-link>架构</a><span class=category-list-count>1</span></li></ul></div></div><div class=widget><h3 class=widget-title>标签</h3><div class=widget-body><ul class=tag-list><li class=tag-list-item><a href=/tags/Hardhat/ class=tag-list-link>Hardhat</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/JAX/ class=tag-list-link>JAX</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/LLM/ class=tag-list-link>LLM</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/NFT/ class=tag-list-link>NFT</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/Php-Storm/ class=tag-list-link>Php-Storm</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/Predis/ class=tag-list-link>Predis</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/SOL/ class=tag-list-link>SOL</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/Solana/ class=tag-list-link>Solana</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/Solidity/ class=tag-list-link>Solidity</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/ddd/ class=tag-list-link>ddd</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/docker/ class=tag-list-link>docker</a><span class=tag-list-count>4</span></li><li class=tag-list-item><a href=/tags/gemma/ class=tag-list-link>gemma</a><span class=tag-list-count>5</span></li><li class=tag-list-item><a href=/tags/go/ class=tag-list-link>go</a><span class=tag-list-count>57</span></li><li class=tag-list-item><a href=/tags/hexo/ class=tag-list-link>hexo</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/kerasNLP/ class=tag-list-link>kerasNLP</a><span class=tag-list-count>3</span></li><li class=tag-list-item><a href=/tags/laravel/ class=tag-list-link>laravel</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/linux/ class=tag-list-link>linux</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/nginx/ class=tag-list-link>nginx</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/nuxt/ class=tag-list-link>nuxt</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/php/ class=tag-list-link>php</a><span class=tag-list-count>5</span></li><li class=tag-list-item><a href=/tags/redis/ class=tag-list-link>redis</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/rust/ class=tag-list-link>rust</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/swoole/ class=tag-list-link>swoole</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/web3/ class=tag-list-link>web3</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/xdebug/ class=tag-list-link>xdebug</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/%E4%BB%A5%E5%A4%AA%E5%9D%8A/ class=tag-list-link>以太坊</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/%E6%80%BB%E7%BB%93/ class=tag-list-link>总结</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=/tags/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/ class=tag-list-link>智能合约</a><span class=tag-list-count>1</span></li></ul></div></div><div class=widget><h3 class=widget-title>最新文章</h3><div class=widget-body><ul class="recent-post-list list-unstyled no-thumbnail"><li><div class=item-inner><p class=item-title><a href=/2025/01/23/solana-tutorial-1.html class=title>Solana 链开发实战（一）</a></p><p class=item-date><time datetime="2025-01-23 18:08:23 +0000 UTC" itemprop=datePublished>2025-01-23</time></p></div></li><li><div class=item-inner><p class=item-title><a href=/2024/04/20/Gemma-JAX-inference.html class=title>Gemma JAX 推理</a></p><p class=item-date><time datetime="2024-04-20 23:10:39 +0000 UTC" itemprop=datePublished>2024-04-20</time></p></div></li><li><div class=item-inner><p class=item-title><a href=/2024/03/30/Keras-Gemma-distributed-finetuning-and-inference.html class=title>在使用 Keras 进行 Gemma 模型的分布式微调和推理</a></p><p class=item-date><time datetime="2024-03-30 22:32:29 +0000 UTC" itemprop=datePublished>2024-03-30</time></p></div></li><li><div class=item-inner><p class=item-title><a href=/2024/03/30/Fine-tune-Gemma-model-in-Keras-using-LoRA.html class=title>在 Keras 中使用 LoRA 微调 Gemma 模型</a></p><p class=item-date><time datetime="2024-03-30 21:42:12 +0000 UTC" itemprop=datePublished>2024-03-30</time></p></div></li><li><div class=item-inner><p class=item-title><a href=/2024/03/30/Get-started-with-Gemma-using-KerasNLP.html class=title>使用 KerasNLP 快速开始 Gemma</a></p><p class=item-date><time datetime="2024-03-30 19:20:02 +0000 UTC" itemprop=datePublished>2024-03-30</time></p></div></li></ul></div></div></div></aside><aside class="sidebar sidebar-toc collapse" id=collapseToc itemscope itemtype=http://schema.org/WPSideBar><div class=slimContent><h4 class=toc-title>文章目录</h4><nav id=toc class="js-toc toc"></nav></div></aside><main class=main role=main><div class=content><article id=- class="article article-type-" itemscope itemtype=http://schema.org/BlogPosting><div class=article-header><h1 itemprop=name><a class=article-title href=/2024/03/30/Get-started-with-Gemma-using-KerasNLP.html>使用 KerasNLP 快速开始 Gemma</a></h1><div class=article-meta><span class=article-date><i class="icon icon-calendar-check"></i>&nbsp;
<a href=/2024/03/30/Get-started-with-Gemma-using-KerasNLP.html class=article-date><time datetime="2024-03-30 19:20:02 +0000 UTC" itemprop=datePublished>2024-03-30</time></a></span>
<span class=article-category><i class="icon icon-folder"></i>&nbsp;
<a class=article-category-link href=/categories/%E5%BC%80%E5%8F%91/>开发</a>
<a class=article-category-link href=/categories/AI/>AI</a></span>
<span class=article-tag><i class="icon icon-tags"></i>&nbsp;
<a class=article-tag-link href=/tags/gemma/>gemma</a>
<a class=article-tag-link href=/tags/kerasNLP/>kerasNLP</a></span>
<span class=post-comment><i class="icon icon-comment"></i>&nbsp;<a href=/2024/03/30/Get-started-with-Gemma-using-KerasNLP.html#comments class=article-comment-link>评论</a></span>
<span class="post-wordcount hidden-xs" itemprop=wordCount>字数统计: 1800字</span>
<span class="post-readcount hidden-xs" itemprop=timeRequired>阅读时长: 4分</span></div></div><div class="article-entry marked-body js-toc-content" itemprop=articleBody><p>本教程将向您展示如何使用 KerasNLP<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> 开始使用 Gemma。Gemma 是一个轻量级的、采用最新技术的开放模型家族，这些技术源于创建 Gemini 模型的同一研究和技术。KerasNLP 是一个自然语言处理（NLP）模型的集合，这些模型使用 Keras<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> 实现，并能在 JAX、PyTorch 和 TensorFlow 上运行。</p><p>在本教程中，您将使用 Gemma 生成对几个提示的文本响应。如果您对 Keras 不熟悉，可能会想在开始前阅读《 Keras 入门<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>》，但这不是必须的。通过本教程的学习，您将更加了解 Keras。</p><h2 id=设置>设置</h2><h3 id=gemma-设置>Gemma 设置</h3><p>要完成本教程，您首先需要按照 Gemma 设置<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>的说明完成设置。Gemma 设置说明将向您展示如何进行以下操作：</p><p>Gemma 模型由 Kaggle 托管。要使用 Gemma，请在 Kaggle 上请求访问权限：</p><ul><li>在 kaggle.com<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup> 登录或注册。</li><li>打开 Gemma 模型卡片<sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup>并选择“请求访问权限”。</li><li>完成同意表格并接受条款和条件。</li></ul><h3 id=安装依赖>安装依赖</h3><p>安装 Keras 和 KerasNLP</p><pre><code class=language-bash># 安装最新的 Keras 3。更多信息查看 https://keras.io/getting_started/。

!pip install -q -U keras-nlp
!pip install -q -U keras&gt;=3
</code></pre><h3 id=导入包>导入包</h3><p>导入 Keras 和 KerasNLP。</p><pre><code class=language-python>import keras
import keras_nlp
</code></pre><h3 id=选择一个后端>选择一个后端</h3><p>Keras 是一个高级的、多框架的深度学习API，设计上注重简单性和易用性。Keras 3 <sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup>允许您选择后端：TensorFlow、JAX或 PyTorch。这三个后端对于本教程都适用。</p><pre><code class=language-python>import os

os.environ[&quot;KERAS_BACKEND&quot;] = &quot;jax&quot;  # 或者 &quot;tensorflow&quot; 、 &quot;torch&quot;。
</code></pre><h2 id=创建模型>创建模型</h2><p>KerasNLP 提供了许多流行模型架构<sup id=fnref:8><a href=#fn:8 class=footnote-ref role=doc-noteref>8</a></sup>的实现。在本教程中，您将使用 GemmaCausalLM 创建一个模型，这是一个端到端的 Gemma 模型，用于因果语言建模。因果语言模型基于之前的 token 预测下一个 token。</p><p>使用<code>from_preset</code>方法创建模型：</p><pre><code class=language-python>gemma_lm = keras_nlp.models.GemmaCausalLM.from_preset(&quot;gemma_2b_en&quot;)
</code></pre><p><code>from_preset</code>方法通过预设的架构和权重来实例化模型。在上述代码中，字符串"gemma_2b_en"指定了预设的架构：一个拥有20亿参数的 Gemma 模型。（也提供了一个有70亿参数的 Gemma 模型。要在 Colab上运行更大的模型，您需要访问付费计划中提供的高级GPU。或者，您也可以在Kaggle 或 Google Cloud 上进行 Gemma 7B 模型的分布式调优<sup id=fnref:9><a href=#fn:9 class=footnote-ref role=doc-noteref>9</a></sup>。）</p><p>使用<code>summary</code>方法可以获取更多关于模型的信息：</p><pre><code class=language-py>gemma_lm.summary()
</code></pre><pre><code class=language-bash>Preprocessor: &quot;gemma_causal_lm_preprocessor&quot;
</code></pre><table><thead><tr><th>Tokenizer (type)</th><th>Vocab #</th></tr></thead><tbody><tr><td>gemma_tokenizer (GemmaTokenizer)</td><td>256,000</td></tr></tbody></table><pre><code class=language-bash>Model: &quot;gemma_causal_lm&quot;
</code></pre><table><thead><tr><th>Layer (type)</th><th>Output Shape</th><th>Param #</th><th>Connected to</th></tr></thead><tbody><tr><td>padding_mask (InputLayer)</td><td>(None, None)</td><td>0</td><td>-</td></tr><tr><td>token_ids (InputLayer)</td><td>(None, None)</td><td>0</td><td>-</td></tr><tr><td>gemma_backbone (GemmaBackbone)</td><td>(None, None, 2048)</td><td>2,506,172,416</td><td>padding_mask[0][0], token_ids[0][0]</td></tr><tr><td>token_embedding (ReversibleEmbedding)</td><td>(None, None, 256000)</td><td>524,288,000</td><td>gemma_backbone[0][0]</td></tr></tbody></table><pre><code class=language-bash> Total params: 2,506,172,416 (9.34 GB)
</code></pre><pre><code class=language-bash> Trainable params: 2,506,172,416 (9.34 GB)
</code></pre><pre><code class=language-bash> Non-trainable params: 0 (0.00 B)
</code></pre><p>从摘要中可以看到，该模型具有25亿可训练的参数。</p><h2 id=生成文本>生成文本</h2><p>现在是时候生成一些文本了！模型有一个<code>generate</code>方法，可以基于一个提示来生成文本。可选的<code>max_length</code>参数指定了生成序列的最大长度。</p><p>尝试使用提示“What is the meaning of life?”来试一试。</p><pre><code class=language-python>gemma_lm.generate(&quot;What is the meaning of life?&quot;, max_length=64)
</code></pre><pre><code class=language-bash>'What is the meaning of life?\n\nThe question is one of the most important questions in the world.\n\nIt’s the question that has been asked by philosophers, theologians, and scientists for centuries.\n\nAnd it’s the question that has been asked by people who are looking for answers to their own lives'
</code></pre><p>调用<code>generate</code>方法时，可以尝试使用一个不同的提示。</p><pre><code class=language-python>gemma_lm.generate(&quot;How does the brain work?&quot;, max_length=64)
</code></pre><pre><code class=language-bash>'How does the brain work?\n\nThe brain is the most complex organ in the human body. It is responsible for controlling all of the body’s functions, including breathing, heart rate, digestion, and more. The brain is also responsible for thinking, feeling, and making decisions.\n\nThe brain is made up'
</code></pre><p>如果您使用的是 JAX 或 TensorFlow 后端，您会注意到第二次调用<code>generate</code>方法几乎立即返回结果。这是因为每次对给定批量大小和<code>max_length</code>的<code>generate</code>调用都会用XLA编译。第一次运行成本较高，但后续运行会快得多。</p><p>您也可以使用列表作为输入来提供批量的提示：</p><pre><code class=language-python>gemma_lm.generate(
    [&quot;What is the meaning of life?&quot;,
     &quot;How does the brain work?&quot;],
    max_length=64)
</code></pre><pre><code class=language-bash>['What is the meaning of life?\n\nThe question is one of the most important questions in the world.\n\nIt’s the question that has been asked by philosophers, theologians, and scientists for centuries.\n\nAnd it’s the question that has been asked by people who are looking for answers to their own lives',
 'How does the brain work?\n\nThe brain is the most complex organ in the human body. It is responsible for controlling all of the body’s functions, including breathing, heart rate, digestion, and more. The brain is also responsible for thinking, feeling, and making decisions.\n\nThe brain is made up']
</code></pre><h3 id=可选操作尝试不同的采样器>可选操作：尝试不同的采样器</h3><p>您可以通过在<code>compile()</code>上设置<code>sampler</code>参数来控制 GemmaCausalLM 的生成策略。默认情况下，将使用“greedy”（贪婪）采样<sup id=fnref:10><a href=#fn:10 class=footnote-ref role=doc-noteref>10</a></sup>。</p><p>作为实验，尝试设置一个“top_k”<sup id=fnref:11><a href=#fn:11 class=footnote-ref role=doc-noteref>11</a></sup>策略：</p><pre><code class=language-python>gemma_lm.compile(sampler=&quot;top_k&quot;)
gemma_lm.generate(&quot;What is the meaning of life?&quot;, max_length=64)
</code></pre><pre><code class=language-bash>'What is the meaning of life? That is a question that has been asked for centuries and has yet to be answered. However, there are some people who believe they know the answer and they are willing to share it with the rest of us. In this essay, I will explore the meaning of life from their perspective'
</code></pre><p>虽然默认的贪婪算法总是选择概率最大的token，但top-K算法会从概率最高的K个token中随机挑选下一个token。</p><p>您不必特别指定一个采样器，如果最后的代码片段对您的使用案例没有帮助，可以忽略它。如果您想了解更多可用的采样器，请参阅“采样器”<sup id=fnref:12><a href=#fn:12 class=footnote-ref role=doc-noteref>12</a></sup>一节。</p><h2 id=来源>来源</h2><p>本文翻译自 Get started with Gemma using KerasNLP <a href=https://www.kaggle.com/code/nilaychauhan/get-started-with-gemma-using-kerasnlp/notebook>https://www.kaggle.com/code/nilaychauhan/get-started-with-gemma-using-kerasnlp/notebook</a></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>KerasNLP <a href=https://keras.io/keras_nlp/>https://keras.io/keras_nlp/</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Keras <a href=https://keras.io/>https://keras.io/</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>Keras 入门 <a href=https://keras.io/getting_started/>https://keras.io/getting_started/</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>Gemma 设置 <a href=https://ai.google.dev/gemma/docs/setup>https://ai.google.dev/gemma/docs/setup</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p>kaggle.com <a href=https://www.kaggle.com/>https://www.kaggle.com/</a>&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p>Gemma 模型卡片 <a href=https://www.kaggle.com/models/google/gemma>https://www.kaggle.com/models/google/gemma</a>&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7><p>Keras 3 <a href=https://keras.io/keras_3>https://keras.io/keras_3</a>&#160;<a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:8><p>模型架构 <a href=https://keras.io/api/keras_nlp/models/>https://keras.io/api/keras_nlp/models/</a>&#160;<a href=#fnref:8 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:9><p>Gemma 7B 模型的分布式调优 <a href=https://ai.google.dev/gemma/docs/distributed_tuning>https://ai.google.dev/gemma/docs/distributed_tuning</a>&#160;<a href=#fnref:9 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:10><p>greedy 采样 <a href=https://keras.io/api/keras_nlp/samplers/greedy_sampler/#greedysampler-class>https://keras.io/api/keras_nlp/samplers/greedy_sampler/#greedysampler-class</a>&#160;<a href=#fnref:10 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:11><p>top_k 采样 <a href=https://keras.io/api/keras_nlp/samplers/top_k_sampler/>https://keras.io/api/keras_nlp/samplers/top_k_sampler/</a>&#160;<a href=#fnref:11 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:12><p>采样器 <a href=https://keras.io/api/keras_nlp/samplers/>https://keras.io/api/keras_nlp/samplers/</a>&#160;<a href=#fnref:12 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=article-footer><blockquote class=mt-2x><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>本文链接:</strong>
<a href=https://www.ganymedenil.com/2024/03/30/Get-started-with-Gemma-using-KerasNLP.html title="使用 KerasNLP 快速开始 Gemma" target=_blank rel=external>https://www.ganymedenil.com/2024/03/30/Get-started-with-Gemma-using-KerasNLP.html</a></li><li class=post-copyright-license><strong>版权声明：</strong><a href=http://creativecommons.org/licenses/by/4.0/deed.zh target=_blank rel=external>本博客所有文章除特别声明外，均采用 CC BY 4.0 CN协议 许可协议。转载请注明出处</a></li></ul></blockquote><div class="panel panel-default panel-badger"><div class=panel-body><figure class=media><div class=media-left><a href=https://github.com/GanymedeNil target=_blank class="img-burn thumb-sm visible-lg"><img src=/avatar.png class="img-rounded w-full" alt></a></div><div class=media-body><h3 class=media-heading><a href=https://github.com/GanymedeNil target=_blank><span class=text-dark>Ganymede Nil</span><small class=ml-1x>Developer</small></a></h3><div>喜欢新事物，关注后端动态，对新的技术有追求； 喜欢 coding。</div></div></figure></div></div></div></article><section id=comments><div id=vcomments></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom><div class=bar-inner><ul class="pager pull-left"><li class=prev><a href=/2024/03/24/Google-Gemma-2B-fine-tuning-practice-IT-technology-news-headline-generation.html title="Google Gemma 2B 微调实战（IT科技新闻标题生成）"><i class="icon icon-angle-left" aria-hidden=true></i><span>&nbsp;&nbsp;下一篇</span></a></li><li class=next><a href=/2024/03/30/Fine-tune-Gemma-model-in-Keras-using-LoRA.html title="在 Keras 中使用 LoRA 微调 Gemma 模型"><span>上一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden=true></i></a></li><li class=toggle-toc><a class="toggle-btn collapsed" data-toggle=collapse href=#collapseToc aria-expanded=false title=文章目录 role=button><span>[&nbsp;</span><span>文章目录</span>
<i class="text-collapsed icon icon-anchor"></i>
<i class="text-in icon icon-close"></i>
<span>]</span></a></li></ul><button type=button class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle=modal data-target=#donateModal><span>赏</span></button><div class=bar-right><div class=share-component data-sites=weibo,qq,wechat,facebook,twitter data-mobile-sites=weibo,qq,qzone></div></div></div></nav><div class="modal modal-center modal-small modal-xs-full fade" id=donateModal tabindex=-1 role=dialog><div class=modal-dialog role=document><div class="modal-content donate"><button type=button class=close data-dismiss=modal aria-label=Close><span aria-hidden=true>&#215;</span></button><div class=modal-body><div class=donate-box><div class=donate-head><p>感谢您的支持,我会继续努力的!</p></div><div class=tab-content><div role=tabpanel class="tab-pane fade active in" id=alipay><div class=donate-payimg><img src=/donate/alipay.jpg alt=扫码支持 title=扫一扫></div><p class="text-muted mv">扫码打赏, 多少你说了算~</p><p class=text-grey>打开支付宝扫一扫，即可进行扫码打赏哦~</p></div><div role=tabpanel class="tab-pane fade" id=wechatpay><div class=donate-payimg><img src=/donate/weipay.jpg alt=扫码支持 title=扫一扫></div><p class="text-muted mv">扫码打赏, 多少你说了算~</p><p class=text-grey>打开微信扫一扫，即可进行扫码打赏哦</p></div></div><div class=donate-footer><ul class="nav nav-tabs nav-justified" role=tablist><li role=presentation class=active><a href=#alipay id=alipay-tab role=tab data-toggle=tab aria-controls=alipay aria-expanded=true><i class="icon icon-alipay"></i> 支付宝</a></li><li role=presentation><a href=#wechatpay role=tab id=wechatpay-tab data-toggle=tab aria-controls=wechatpay aria-expanded=false><i class="icon icon-wepay"></i>
微信支付</a></li></ul></div></div></div></div></div></div></main><footer class=footer itemscope itemtype=http://schema.org/WPFooter><ul class=social-links><li><a href=https://github.com/GanymedeNil target=_blank title=github data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li><li><a href=/index.xml target=_blank title=rss data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li><li><a href=http://weibo.com/jinhongyang target=_blank title=weibo data-toggle=tooltip data-placement=top><i class="icon icon-weibo"></i></a></li></ul><div class=copyright>&copy;2017 -
2025<div class=publishby>Theme by <a href=https://github.com/cofess target=_blank>cofess </a>base on<a href=https://github.com/cofess/hexo-theme-pure target=_blank> pure</a>.</div><div>powered by <a href=https://gohugo.io/ target=_blank>hugo</a></div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<script type=text/x-mathjax-config>
    MathJax.Hub.Config({
            showMathMenu: false, //disables context menu
            tex2jax: {
            inlineMath: [ ['$','$'], ['\\(','\\)'] ]
           }
    });
</script><script src=https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js></script>
<script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/highlight.min.js></script>
<script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/languages/go.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/languages/php.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/languages/bash.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/languages/cmake.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/languages/dockerfile.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/languages/json.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/languages/lua.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/languages/makefile.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/languages/nginx.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/languages/rust.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/languages/shell.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/highlight.js/9.15.10/languages/yaml.min.js defer></script><script>hljs.configure({tabReplace:"    ",classPrefix:""}),hljs.initHighlightingOnLoad()</script>
<script src=/js/application.min.7ef841188add421ff966768c2e5f1a1551076353a65f0d39fbaf504b456936f8.js></script>
<script src=/js/plugin.min.738a460bf4317fac61717f1bca393e53d00973db9754d9f0a81c7312d5874840.js></script>
<script>(function(e){var t={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"(未命名)"},ROOT_URL:"https://www.ganymedenil.com",CONTENT_URL:"https://www.ganymedenil.com/searchindex.json "};e.INSIGHT_CONFIG=t})(window)</script><script type=text/javascript src=/js/insight.min.716b0c6a00b68ccc31a2b65345f3412f4246ffa94a90f8e25d525528b4504f9937880692bbe619023233caba5d0a17ebe23d7cfb57cd3a88f23ea337ad5e4d00.js defer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js></script>
<script>tocbot.init({tocSelector:".js-toc",contentSelector:".js-toc-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0})</script><script src=https://cdn1.lncld.net/static/js/3.0.4/av-min.js></script>
<script src=https://cdn.jsdelivr.net/npm/valine></script>
<script type=text/javascript>var GUEST=["nick","mail","link"],meta="nick,mail",meta=meta.split(",").filter(function(e){return GUEST.indexOf(e)>-1});new Valine({el:"#vcomments",verify:null,notify:null,appId:"lI57bh1xqblhjL3OUrOcnX2R-gzGzoHsz",appKey:"2aCHvIxz6nKXqP0sBq42gBhC",placeholder:"enjoy~",avatar:"mm",meta,pageSize:"10"||10,visitor:!1})</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-140810980-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-140810980-1")</script></body></html>